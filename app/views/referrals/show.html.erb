<% if @referral.user == current_user %>
  <div class="p-2 text-center alert alert-warning mb-0">
    <div class="center-box-max-width d-flex">
      <div class="mr-auto">
        <!-- <a class="btn btn-outline-secondary" href="<%= edit_offer_path @referral.uuid %>">Edit</a> -->
        <%= link_to "Delete", referral_path(@referral.uuid), method: :delete, data: { confirm: "Are you sure you want to delete this referral request?" }, class: "btn btn-link text-danger" %>
      </div>
    </div>
  </div>
<% end %>



<div class="text-white company-header bg-secondary p-4">
  <div class="d-flex justify-content-center">
    <div class="mr-3">
      <a href="<%= company_path @referral.company.uuid %>">
        <div class="bg-white image-thumbnail-outer-lg rounded d-flex justify-content-center">
          <img class="align-self-center image-thumbnail-lg rounded" src="<%= @referral.company.logo_url %>">
        </div>
      </a>
    </div>

    <div>
      <div class="font-weight-light">
        <a href="<%= company_path @referral.company.uuid %>" class="text-white">
          <%= @referral.company.display_name %>
        </a>
      </div>
      <div class="lead font-weight-bold">
        <%= @referral.position %>
      </div>
      <div>
        <%= @referral.yoe ? "(#{@referral.yoe.to_i} YOE)" : "" %>
      </div>
      <div class="font-weight-light text-light">
        <span class="fa fa-map-marker-alt"></span> <%= @referral.location %>
      </div>
    </div>
  </div>

  <hr class="mt-3 mb-2" />

  <div class="text-center text-white">
    <div class="small text-light font-weight-light">
      <div>
        posted <%= time_ago_in_words @referral.created_at %> ago
      </div>
    </div>
  </div>
</div>


<div class="border-bottom p-3 bg-light">
  <div class="center-box-max-width">

    <div class="mb-3 sharethis-inline-share-buttons"></div>

    <div class="col-12 mb-3 mb-md-3">
      <div class="text-center card-shadow rounded bg-white p-3">
        <% if current_user == @referral.user %>
          <p class="text-justify">
            Your referral request is pending and
            <b><%= @referral.company.display_name %></b> employees will refer you very soon.
            We will disclose your <b>name, email, phone number</b> and <b>linkedin</b> to the person accepting your request.
          </p>

          <p class="small">
            If you change your mind and no longer want to be referred at <%= @referral.company.display_name %>, you can  <%= link_to "delete your request", referral_path(@referral.uuid), method: :delete, data: { confirm: "Are you sure you want to delete this referral request?" }, class: "text-danger" %>.
          </p>
        <% elsif @referral.company == current_user&.company %>
          <p>
            This referral request is still pending... Take it now!
          </p>
          <p>
            The candidate's <b>name, email, phone number</b> and <b>linkedin</b> will be disclosed as soon as this request is unlocked.
          </p>
          <%= link_to "Unlock this referral", referral_path(@referral.uuid), method: :get, data: { confirm: "Not yet available, but we are working on it :)" }, class: "btn btn-danger" %>
        <% else %>
          <p>
            Unfortunately, only <b><%= @referral.company.display_name %></b> employees can unlock this referral.
          </p>
          <p>
            If you work at <b><%= @referral.company.display_name %></b> and want to refer this candidate, you will need to
            <% if current_user %>
              <%= link_to logout_path, method: :delete, data: { confirm: "Are you sure you want to log out?" }, class: "text-danger" do %>
                login/signup with your <%= @referral.company.display_name %> email
              <% end %>
            <% else %>
              <a href="/login" class="text-danger">login/signup with your <%= @referral.company.display_name %> email</a>
            <% end %>
          </p>
          <p>
            Or, if you know someone at <b><%= @referral.company.display_name %></b>, you can send them this link:
            <div class="input-group">
              <input id="referralUrl" type="text" value="<%= referral_url(@referral.uuid) %>" class="form-control">
              <div class="input-group-append">
                <button type="button" class="btn btn-danger" onclick="copyToClipboard()">Copy</button>
              </div>
            </div>
          </p>

        <% end %>
      </div>
    </div>
  </div>
</div>

<script>
  function copyToClipboard() {
    var copyText = document.getElementById('referralUrl');
    copyText.select();
    document.execCommand('copy');
  }
</script>
